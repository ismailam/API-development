<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: location.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: location.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

const request = require('request')

/**
 * This module takes in the address of the tenant, gets the house number, postcode and adds it to the tenant!
 * @param {string} location - the address of the tenant.
 * @return {Promise&lt;object|Error>} Location Details.
 */
exports.getLocation = location => new Promise( (resolve, reject) => {
	const url = `https://maps.googleapis.com/maps/api/geocode/json?region=gb&amp;units=metric&amp;appid=44c39f3fa462f86b3fc88f5678e5c5ff&amp;address=${location}`

	request.get( url, (err, res, body) => {
		if (err) reject(Error('invalid location: could not find'))
		const json = JSON.parse(body)

		if (json.status === 'ZERO_RESULTS') reject(Error('no results found'))

		const locationDetails= {
			House_Number: json.results[0].address_components[0].long_name,
			Post_Code: json.results[0].address_components[6].long_name,
			Location: {lat: json.results[0].geometry.location.lat.toFixed(6), long: json.results[0].geometry.location.lng.toFixed(6)
			}
		}
		
		console.log(locationDetails)

		resolve(locationDetails)
	})
})


/**
 * This module gets the distance between the agency location and tenant location ands it to the tenant object!
 * @param {string} agencyLocation - The username already created.
 * @param {string} tenantsLocation - The new password to update.
 * @return {Promise&lt;object|Error>} distance details.
 */
exports.distanceFromAgency = (agencyLocation, tenantsLocation) => new Promise( (resolve, reject) => {

	const url = `https://maps.googleapis.com/maps/api/distancematrix/json?units=imperial&amp;origins=${agencyLocation}&amp;destinations=${tenantsLocation}&amp;key=AIzaSyDhxZcgm_f3Tdc93_LHhl2KA9MUj1Eh_jc`

	request.get( url, (err, res, body) => {

		if (err) reject(Error('failed to make API call'))

		const json = JSON.parse(body)

		if (json.status === 'ZERO_RESULTS') reject(Error('no results found'))

		const distanceDetails= {
			Distance: json.rows[0].elements[0].distance.text,
			Duration: json.rows[0].elements[0].duration.text
		}

		resolve(distanceDetails)
	})
})


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#deleteTenant">deleteTenant</a></li><li><a href="global.html#deleteUser">deleteUser</a></li><li><a href="global.html#distanceFromAgency">distanceFromAgency</a></li><li><a href="global.html#getLocation">getLocation</a></li><li><a href="global.html#getTenant">getTenant</a></li><li><a href="global.html#getTenants">getTenants</a></li><li><a href="global.html#isAuthenticated">isAuthenticated</a></li><li><a href="global.html#isPayed">isPayed</a></li><li><a href="global.html#postTenant">postTenant</a></li><li><a href="global.html#postUser">postUser</a></li><li><a href="global.html#updatePassword">updatePassword</a></li><li><a href="global.html#updateTenant">updateTenant</a></li><li><a href="global.html#userschema">userschema</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Dec 14 2016 14:49:36 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
